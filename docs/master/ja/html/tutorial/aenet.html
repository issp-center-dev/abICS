
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4.1. ニューラルネットワークの構築 &#8212; abICS 2.0.0 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="5. 入力ファイルフォーマット" href="../inputfiles/index.html" />
    <link rel="prev" title="4. チュートリアル" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="sec-tutorial">
<span id="id1"></span><h1><span class="section-number">4.1. </span>ニューラルネットワークの構築<a class="headerlink" href="#sec-tutorial" title="Permalink to this heading">¶</a></h1>
<p>ここでは、aenet を用いてニューラルネットワークモデルの構築を行う方法について記載します。
第一原理ソルバーには Quantum ESPRESSO (QE) を使います。
例題としてMgAl2O4スピネルのMg/Al反転度の温度依存性を計算します。
最安定構造では全てのMgが酸素に四面体配位されていて、Alは八面体配位になっています。
このサイト間の反転度の温度依存性をシミュレーションします。
なお、本チュートリアルで使用する入力ファイル一式は <code class="docutils literal notranslate"><span class="pre">examples/active_learning_qe/</span></code> にあります。
以下では aenet および GNU parallel のインストールについても簡単に説明していますが、システムに既にインストールされている場合はそちらを使ってください。
なお、計算の実行環境は物性研究所スーパーコンピュータシステムBのohtakaを利用しています。</p>
<section id="id2">
<h2><span class="section-number">4.1.1. </span>事前準備<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<section id="aenet">
<h3>aenetのインストール<a class="headerlink" href="#aenet" title="Permalink to this heading">¶</a></h3>
<p>abICSでは、ニューラルネットワークモデルの構築のためにaenetを利用します。
aenetは <a class="reference external" href="http://ann.atomistic.net">http://ann.atomistic.net</a> からダウンロードできます。
Documentation の Installation に従ってインストールしてください。
なお、abICSでは、ニューラルネットワークの学習と評価にaenetの <code class="docutils literal notranslate"><span class="pre">train.x</span></code> と <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> を使います。
<code class="docutils literal notranslate"><span class="pre">train.x</span></code> についてはMPI並列版が利用可能ですが、 <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> についてはMPIを使用しない実行ファイル(serial)を使用する必要があります。
そのため、makefilesの下にあるserial版もインストールするようにしてください。</p>
</section>
<section id="gnu-parallel">
<h3>GNU parallelのインストール<a class="headerlink" href="#gnu-parallel" title="Permalink to this heading">¶</a></h3>
<p>チュートリアルでは、GNU parallelを用いて Quantum Espresso による第一原理計算を並列実行します。
GNU parallelは <a class="reference external" href="https://www.gnu.org/software/parallel/">https://www.gnu.org/software/parallel/</a> からダウンロードできます (Macの場合はhomebrewにより直接インストールすることも可能です)。
インストールは基本的には、ダウンロードして解凍したディレクトリ に移動した後、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./configure &amp;&amp; make &amp;&amp; make install
</pre></div>
</div>
<p>でインストールできます。詳細な設定は公式マニュアルを参考にしてください。</p>
</section>
</section>
<section id="id3">
<h2><span class="section-number">4.1.2. </span>学習データ生成用入力ファイルの準備<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p>ニューラルネットワークの作成にあたり、
原子配置を入力、エネルギーを出力とした学習データを、
第一原理計算により作成する必要があります。
学習データの作成には、</p>
<ul class="simple">
<li><p>abICS</p></li>
<li><p>利用する第一原理ソルバー</p></li>
</ul>
<p>に関する入力ファイルを準備する必要があります。</p>
<section id="abics-input-toml">
<h3>abICS制御ファイル (<code class="docutils literal notranslate"><span class="pre">input.toml</span></code>)<a class="headerlink" href="#abics-input-toml" title="Permalink to this heading">¶</a></h3>
<p>計算対象とする格子構造の定義と、abICSによる能動学習のループ全体の制御、およびレプリカ交換モンテカルロ法に関するパラメータを設定します。
<code class="docutils literal notranslate"><span class="pre">st2abics</span></code> ツールを使うことで、結晶構造ファイルから <code class="docutils literal notranslate"><span class="pre">input.toml</span></code> のひな形を自動で生成することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd [example_dir]
$ st2abics st2abics_MgAl2O4.toml MgAl2O4.vasp &gt; input.toml
</pre></div>
</div>
<p>以下では <code class="docutils literal notranslate"><span class="pre">input.toml</span></code> の中で第一原理計算によ る学習データに関連するセクションの設定内容をもう少し詳しく解説します。</p>
<section id="i-mlref">
<h4>(i)  <code class="docutils literal notranslate"><span class="pre">[mlref]</span></code> セクション<a class="headerlink" href="#i-mlref" title="Permalink to this heading">¶</a></h4>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[mlref]</span><span class="w"></span>
<span class="n">nreplicas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="n">ndata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
</pre></div>
</div>
<p>RXMC計算の結果から、ニューラルネットワークモデルの精度評価と訓練データの拡張のために原子配置を取り出す際のオプションが設定できます。
基本的に、 <code class="docutils literal notranslate"><span class="pre">nreplicas</span></code> は 後述する <code class="docutils literal notranslate"><span class="pre">[sampling]</span></code> セクションと同じ値にしてください。
<code class="docutils literal notranslate"><span class="pre">ndata</span></code> は、RXMC計算で出力される配置の数（後述する <code class="docutils literal notranslate"><span class="pre">[sampling]</span></code> セクションの <code class="docutils literal notranslate"><span class="pre">nsteps/sample_frequency</span></code> の値）から、
何個のデータを機械学習用に取り出すかを指定します。従って、RXMC計算で出力される配置の数以下の値に設定してください。</p>
</section>
<section id="ii-mlref-solver">
<h4>(ii)  <code class="docutils literal notranslate"><span class="pre">[mlref.solver]</span></code> セクション<a class="headerlink" href="#ii-mlref-solver" title="Permalink to this heading">¶</a></h4>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mlref</span><span class="p">.</span><span class="n">solver</span><span class="p">]</span><span class="w"> </span><span class="c1"># 参照第一原理ソルバーの設定</span><span class="w"></span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;qe&#39;</span><span class="w"></span>
<span class="n">base_input_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;./baseinput_ref&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;./baseinput_ref&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;./baseinput_ref&#39;</span><span class="p">]</span><span class="w"> </span><span class="c1">#, &#39;./baseinput_ref&#39;]</span><span class="w"></span>
<span class="n">perturb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="w"></span>
<span class="n">ignore_species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
</pre></div>
</div>
<p>訓練データ（配置エネルギー）の計算に用いるソルバーの設定を行います。この例ではQuantum Espressoで配置エネルギーを求めます。
<code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> は自由に設定して構いません。設定したディレクトリの中に、ソルバーの入力ファイルを設置します（後述）。</p>
<p>上記の例のようにリスト形式で複数設定した場合は、各々のディレクトリ内の入力を使った計算が順番に実行されます。
このときに、2番目以降の計算では
前の計算の最終ステップでの構造が初期座標として用いられます。そして、最後の計算のエネルギーが
学習に使われます。例えば、1つ目の入力ファイルでで精度を犠牲にして高速な構造最適化を行い、2番目以降の入力ファイルで
高精度な設定で構造最適化を行うといった
ことが可能になります。あるいは、格子ベクトルの緩和を行う場合に、設定した平面波カットオフに基づいて計算メッシュをリセット
するために同じ入力の計算を複数回実行するといったことも可能です。</p>
<p><code class="docutils literal notranslate"><span class="pre">perturb</span></code> は、ランダムに各原子を変位させることで、対称性を崩した構造から構造最適化を開始するための
設定です。この場合は、構造緩和を行う原子を全て0.05 Å、ランダムな方向に変位させた構造から1番目の計算が開始されます。</p>
<p><code class="docutils literal notranslate"><span class="pre">ignore_species</span></code> は、第一原理ソルバーを訓練データ生成に用いる場合は空リストを指定しますが、一部の元素を無視するような
モデルを使って訓練データを生成する場合は、無視する元素を指定します。</p>
</section>
<section id="iii-config">
<h4>(iii)  <code class="docutils literal notranslate"><span class="pre">[config]</span></code> セクション<a class="headerlink" href="#iii-config" title="Permalink to this heading">¶</a></h4>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">config</span><span class="p">]</span><span class="w"> </span><span class="c1"># 以下、結晶格子の情報と、格子上に配置される原子や空孔の情報が続く</span><span class="w"></span>
<span class="n">unitcell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="mf">8.1135997772</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">0.0000000000</span><span class="p">,</span><span class="w"> </span><span class="mf">8.1135997772</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000000000</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="k">[0.0000000000, 0.0000000000, 8.1135997772]]</span><span class="w"></span>
<span class="n">supercell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="w"></span>

<span class="k">[[config.base_structure]]</span><span class="w"></span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;O&quot;</span><span class="w"></span>
<span class="n">coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="mf">0.237399980</span><span class="p">,</span><span class="w"> </span><span class="mf">0.237399980</span><span class="p">,</span><span class="w"> </span><span class="mf">0.237399980</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="mf">0.762599945</span><span class="p">,</span><span class="w"> </span><span class="mf">0.762599945</span><span class="p">,</span><span class="w"> </span><span class="mf">0.762599945</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="mf">0.512599945</span><span class="p">,</span><span class="w"> </span><span class="mf">0.012600004</span><span class="p">,</span><span class="w"> </span><span class="mf">0.737399936</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="mf">0.487399966</span><span class="p">,</span><span class="w"> </span><span class="mf">0.987399936</span><span class="p">,</span><span class="w"> </span><span class="mf">0.262599975</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
</pre></div>
</div>
<p>基本的に <code class="docutils literal notranslate"><span class="pre">st2abics</span></code> ツールで生成されたものをそのまま利用できます。
モンテカルロサンプリングを行う原子配置の情報が設定されます。
<code class="docutils literal notranslate"><span class="pre">abics_sampling</span></code> が未実施の場合には、この情報をもとに原子配置がランダムに与えられ、
それらの原子配置を持った第一原理計算用の入力ファイルが生成されます。
<code class="docutils literal notranslate"><span class="pre">abics_sampling</span></code> が既に実行されている場合には、 <code class="docutils literal notranslate"><span class="pre">config</span></code> セクションではなく、
モンテカルロサンプリングで与えられた原子配置に対する第一原理計算用の入力ファイルが生成されます。</p>
</section>
</section>
<section id="qe">
<h3>QE参照ファイルの準備<a class="headerlink" href="#qe" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">baseinput_ref</span></code> にQEのscf計算で参照する入力ファイルを配置します。
以下、サンプルディレクトリにある <code class="docutils literal notranslate"><span class="pre">scf.in</span></code> ファイルを記載します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">CONTROL</span>
<span class="n">calculation</span> <span class="o">=</span> <span class="s1">&#39;relax&#39;</span>
<span class="n">tstress</span> <span class="o">=</span> <span class="o">.</span><span class="n">false</span><span class="o">.</span>
<span class="n">tprnfor</span> <span class="o">=</span> <span class="o">.</span><span class="n">false</span><span class="o">.</span>
<span class="n">pseudo_dir</span> <span class="o">=</span> <span class="s1">&#39;./pseudo&#39;</span>
<span class="n">disk_io</span> <span class="o">=</span> <span class="s1">&#39;low&#39;</span>
<span class="n">wf_collect</span> <span class="o">=</span> <span class="o">.</span><span class="n">false</span><span class="o">.</span>
<span class="o">/</span>
<span class="o">&amp;</span><span class="n">SYSTEM</span>
  <span class="n">ecutwfc</span>      <span class="o">=</span>  <span class="mf">60.0</span>
  <span class="n">occupations</span>  <span class="o">=</span> <span class="s2">&quot;smearing&quot;</span>
  <span class="n">smearing</span>     <span class="o">=</span> <span class="s2">&quot;gauss&quot;</span>
  <span class="n">degauss</span>      <span class="o">=</span> <span class="mf">0.01</span>
<span class="o">/</span>
<span class="o">&amp;</span><span class="n">electrons</span>
  <span class="n">mixing_beta</span> <span class="o">=</span> <span class="mf">0.7</span>
  <span class="n">conv_thr</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">d</span><span class="o">-</span><span class="mi">8</span>
  <span class="n">electron_maxstep</span> <span class="o">=</span> <span class="mi">100</span>
<span class="o">/</span>
<span class="o">&amp;</span><span class="n">ions</span>
<span class="o">/</span>
<span class="n">ATOMIC_SPECIES</span>
<span class="n">Al</span> <span class="mf">26.981</span> <span class="n">Al</span><span class="o">.</span><span class="n">pbe</span><span class="o">-</span><span class="n">nl</span><span class="o">-</span><span class="n">kjpaw_psl</span><span class="mf">.1.0.0</span><span class="o">.</span><span class="n">UPF</span>
<span class="n">Mg</span> <span class="mf">24.305</span> <span class="n">Mg</span><span class="o">.</span><span class="n">pbe</span><span class="o">-</span><span class="n">spnl</span><span class="o">-</span><span class="n">kjpaw_psl</span><span class="mf">.1.0.0</span><span class="o">.</span><span class="n">UPF</span>
<span class="n">O</span>  <span class="mf">16.000</span> <span class="n">O</span><span class="o">.</span><span class="n">pbe</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">kjpaw_psl</span><span class="mf">.1.0.0</span><span class="o">.</span><span class="n">UPF</span>
<span class="n">ATOMIC_POSITIONS</span> <span class="n">crystal</span>

<span class="n">K_POINTS</span> <span class="n">gamma</span>
</pre></div>
</div>
<p>なお、擬ポテンシャルを格納したディレクトリ <code class="docutils literal notranslate"><span class="pre">pseudo_dir</span></code> や
<code class="docutils literal notranslate"><span class="pre">ATOMIC_SPECIES</span></code> で使用する擬ポテンシャルについて、自分の環境に従い書き換える必要があります。
本サンプルで使用している擬ポテンシャルは以下のリンクからダウンロードできます。
（ダウンロードスクリプト <code class="docutils literal notranslate"><span class="pre">download_pp.sh</span></code> が用意されています。）</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pseudopotentials.quantum-espresso.org/upf_files/Al.pbe-nl-kjpaw_psl.1.0.0.UPF">https://pseudopotentials.quantum-espresso.org/upf_files/Al.pbe-nl-kjpaw_psl.1.0.0.UPF</a></p></li>
<li><p><a class="reference external" href="https://pseudopotentials.quantum-espresso.org/upf_files/Mg.pbe-spnl-kjpaw_psl.1.0.0.UPF">https://pseudopotentials.quantum-espresso.org/upf_files/Mg.pbe-spnl-kjpaw_psl.1.0.0.UPF</a></p></li>
<li><p><a class="reference external" href="https://pseudopotentials.quantum-espresso.org/upf_files/O.pbe-n-kjpaw_psl.1.0.0.UPF">https://pseudopotentials.quantum-espresso.org/upf_files/O.pbe-n-kjpaw_psl.1.0.0.UPF</a></p></li>
</ul>
<p>このサンプルでは、QE計算時に構造最適化を行うため <code class="docutils literal notranslate"><span class="pre">calculation</span> <span class="pre">=</span> <span class="pre">'relax'</span></code> を、
計算高速化のため、 <code class="docutils literal notranslate"><span class="pre">K_POINTS</span></code> は <code class="docutils literal notranslate"><span class="pre">gammma</span></code> を選択しています。</p>
</section>
</section>
<section id="id4">
<h2><span class="section-number">4.1.3. </span>ニューラルネットワーク生成用入力ファイルの準備<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h2>
<p>本チュートリアルではaenetを用いニューラルネットワークを作成します。
ニューラルネットワークの作成には、</p>
<ul class="simple">
<li><p>abICS</p></li>
<li><p>aenet</p></li>
</ul>
<p>に関する入力ファイルを準備・設定する必要があります。</p>
<section id="id5">
<h3>abICS制御ファイル (<code class="docutils literal notranslate"><span class="pre">input.toml</span></code>)<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<section id="i-train">
<h4>(i)  <code class="docutils literal notranslate"><span class="pre">[train]</span></code> セクション<a class="headerlink" href="#i-train" title="Permalink to this heading">¶</a></h4>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">train</span><span class="p">]</span><span class="w"> </span><span class="c1"># モデル学習器の設定</span><span class="w"></span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;aenet&#39;</span><span class="w"></span>
<span class="n">base_input_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;./aenet_train_input&#39;</span><span class="w"></span>
<span class="n">exe_command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;generate.x-2.0.4-ifort_serial&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="s">&#39;srun train.x-2.0.4-ifort_intelmpi&#39;</span><span class="p">]</span><span class="w"></span>
<span class="n">ignore_species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;O&quot;</span><span class="p">]</span><span class="w"></span>
<span class="n">vac_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="n">restart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
</pre></div>
</div>
<p>訓練データから配置エネルギー予測モデルを学習する学習器の設定を行います。現在のところ、abICSではaenetのみに
対応しています。 <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> は自由に設定して構いません。設定したディレクトリの中に、学習器の設定ファイルを
設置します（後述）。 <code class="docutils literal notranslate"><span class="pre">exe_command</span></code> にはaenetの <code class="docutils literal notranslate"><span class="pre">generate.x</span></code> と <code class="docutils literal notranslate"><span class="pre">train.x</span></code> へのパスを指定します。
<code class="docutils literal notranslate"><span class="pre">train.x</span></code> についてはMPI並列版が利用可能で、その場合は、上の例で示すように、MPI実行するためのコマンド
（ <code class="docutils literal notranslate"><span class="pre">srun</span></code> 、 <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> など）を合わせて設定してください。</p>
<p><code class="docutils literal notranslate"><span class="pre">ignore_species</span></code> は、第一原理ソルバーを訓練データ生成に用いる場合は空リストを指定しますが、
一部の元素を無視するような
モデルを使って訓練データを生成する場合は、無視する元素を指定します。
<code class="docutils literal notranslate"><span class="pre">vac_map</span></code> 、 <code class="docutils literal notranslate"><span class="pre">restart</span></code> については現状対応していないので、
例のように設定してください。</p>
</section>
</section>
<section id="id6">
<h3>aenet用の入力ファイル<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h3>
<p>aenet用の入力ファイルを <code class="docutils literal notranslate"><span class="pre">[train]</span></code> セクションの <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> で
設定したディレクトリ内の <code class="docutils literal notranslate"><span class="pre">generate</span></code> 、 <code class="docutils literal notranslate"><span class="pre">train</span></code> 、および <code class="docutils literal notranslate"><span class="pre">predict</span></code>
ディレクトリに設置します。</p>
<section id="generate">
<h4>generate<a class="headerlink" href="#generate" title="Permalink to this heading">¶</a></h4>
<p>aenetでは、訓練用の原子配置とエネルギーのデータを、原子環境記述子とエネルギーの関係に変換した中間バイナリフォーマットにまとめてから訓練を行います。
この変換を行う <code class="docutils literal notranslate"><span class="pre">generate.x</span></code> 用の入力ファイルを <code class="docutils literal notranslate"><span class="pre">generate</span></code> ディレクトリに設置します。</p>
<p>まず、元素種ごとの記述子設定ファイルを用意します。ファイル名は任意ですが、チュートリアルでは
<code class="docutils literal notranslate"><span class="pre">Al.fingerprint.stp</span></code> , <code class="docutils literal notranslate"><span class="pre">Mg.fingerprint.stp</span></code> という名前にしています。
例として <code class="docutils literal notranslate"><span class="pre">Al.fingerprint.stp</span></code> の内容を示します：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DESCR</span>
 <span class="n">N</span><span class="o">.</span> <span class="n">Artrith</span> <span class="ow">and</span> <span class="n">A</span><span class="o">.</span> <span class="n">Urban</span><span class="p">,</span> <span class="n">Comput</span><span class="o">.</span> <span class="n">Mater</span><span class="o">.</span> <span class="n">Sci</span><span class="o">.</span> <span class="mi">114</span> <span class="p">(</span><span class="mi">2016</span><span class="p">)</span> <span class="mi">135</span><span class="o">-</span><span class="mf">150.</span>
 <span class="n">N</span><span class="o">.</span> <span class="n">Artrith</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span> <span class="n">Urban</span><span class="p">,</span> <span class="ow">and</span> <span class="n">G</span><span class="o">.</span> <span class="n">Ceder</span><span class="p">,</span> <span class="n">Phys</span><span class="o">.</span> <span class="n">Rev</span><span class="o">.</span> <span class="n">B</span> <span class="mi">96</span> <span class="p">(</span><span class="mi">2017</span><span class="p">)</span> <span class="mf">014112.</span>
<span class="n">END</span> <span class="n">DESCR</span>

<span class="n">ATOM</span> <span class="n">Al</span> <span class="c1"># 元素を指定</span>

<span class="n">ENV</span> <span class="mi">2</span> <span class="c1"># ATOMで指定した元素と相互作用する元素種の数と元素名を指定</span>
<span class="n">Al</span>
<span class="n">Mg</span>

<span class="n">RMIN</span> <span class="mf">0.55</span><span class="n">d0</span> <span class="c1"># 原子間の最隣接距離</span>

<span class="n">BASIS</span> <span class="nb">type</span><span class="o">=</span><span class="n">Chebyshev</span> <span class="c1"># チェビシェフ記述子の設定</span>
<span class="n">radial_Rc</span> <span class="o">=</span> <span class="mf">8.0</span>  <span class="n">radial_N</span> <span class="o">=</span> <span class="mi">16</span> <span class="n">angular_Rc</span> <span class="o">=</span> <span class="mf">6.5</span>  <span class="n">angular_N</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
<p>記述子設定の詳細についてはaenetのドキュメントを参照してください。</p>
<p>次に、
<code class="docutils literal notranslate"><span class="pre">generate.in.head</span></code> という名前で以下の内容のファイルを準備します：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>OUTPUT aenet.train

TYPES
2
Al -0.0  ! eV
Mg -0.0  ! eV

SETUPS
Al   Al.fingerprint.stp
Mg    Mg.fingerprint.stp
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">OUTPUT</span></code> には必ず <code class="docutils literal notranslate"><span class="pre">aenet.train</span></code> を指定してください。
<code class="docutils literal notranslate"><span class="pre">TYPES</span></code> 以下には訓練データ中の元素種とその数を指定します。
元素種ごとにエネルギーの基準を指定することもできますが、基本的には0に設定しておくのが無難です。
<code class="docutils literal notranslate"><span class="pre">SETUPS</span></code> 以下には元素種ごとの記述子設定ファイルを指定します。
ファイルの末尾には必ず改行が入っていることを確認してください。
abICSは <code class="docutils literal notranslate"><span class="pre">generate.in.head</span></code> の末尾に座標ファイルのリストを追加して <code class="docutils literal notranslate"><span class="pre">generate.in</span></code> を生成し、
<code class="docutils literal notranslate"><span class="pre">generate.x</span></code> を実行します。</p>
</section>
<section id="train">
<h4>train<a class="headerlink" href="#train" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">generate</span></code> で生成された訓練データを読み込み、訓練を行う
<code class="docutils literal notranslate"><span class="pre">train.x</span></code> 用の入力ファイルを <code class="docutils literal notranslate"><span class="pre">train</span></code> ディレクトリに設置します。
ファイル名は <code class="docutils literal notranslate"><span class="pre">train.in</span></code> としてください：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>TRAININGSET aenet.train
TESTPERCENT 10
ITERATIONS  500

MAXENERGY 10000

TIMING

!SAVE_ENERGIES

METHOD
bfgs

NETWORKS
! atom   network         hidden
! types  file-name       layers  nodes:activation
  Al     Al.15t-15t.nn    2      15:tanh 15:tanh
  Mg       Mg.15t-15t.nn    2      15:tanh 15:tanh
</pre></div>
</div>
<p>基本的には、 <code class="docutils literal notranslate"><span class="pre">NETWORKS</span></code> セクション以外は変更の必要はありません。
<code class="docutils literal notranslate"><span class="pre">NETWORKS</span></code> セクションでは、生成する元素種ごとのポテンシャル
ファイル名と、ニューラルネットワーク構造、および活性化関数を指定します。</p>
</section>
<section id="predict">
<h4>predict<a class="headerlink" href="#predict" title="Permalink to this heading">¶</a></h4>
<p>訓練したポテンシャルモデルを使って入力座標に対してエネルギーを
評価するための <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> 用の入力ファイル <code class="docutils literal notranslate"><span class="pre">predict.in</span></code> を、 <code class="docutils literal notranslate"><span class="pre">predict</span></code>
ディレクトリに設置します：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPES</span>
<span class="mi">2</span>
<span class="n">Mg</span>
<span class="n">Al</span>

<span class="n">NETWORKS</span>
<span class="n">Mg</span>  <span class="n">Mg</span><span class="mf">.15</span><span class="n">t</span><span class="o">-</span><span class="mi">15</span><span class="n">t</span><span class="o">.</span><span class="n">nn</span>
<span class="n">Al</span>  <span class="n">Al</span><span class="mf">.15</span><span class="n">t</span><span class="o">-</span><span class="mi">15</span><span class="n">t</span><span class="o">.</span><span class="n">nn</span>

<span class="n">VERBOSITY</span> <span class="n">low</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TYPES</span></code> セクションには元素種の数と元素名を、 <code class="docutils literal notranslate"><span class="pre">NETWORKS</span></code>
セクションには元素種ごとのポテンシャルファイル名（ <code class="docutils literal notranslate"><span class="pre">train.in</span></code> で
設定したもの）を入力してください。</p>
<p>また、 <code class="docutils literal notranslate"><span class="pre">VERBOSITY</span></code> は必ず <code class="docutils literal notranslate"><span class="pre">low</span></code> に設定してください。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[sampling.solver]</span></code> セクションの <code class="docutils literal notranslate"><span class="pre">path</span></code> を実行環境における aenet の <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> のパスに設定する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[sampling.solver]</span></code> と <code class="docutils literal notranslate"><span class="pre">[train]</span></code> セクションで <code class="docutils literal notranslate"><span class="pre">ignore_species</span> <span class="pre">=</span> <span class="pre">[&quot;O&quot;]</span></code> を指定する。</p></li>
</ul>
</section>
</section>
<section id="id7">
<h3>計算実行<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h3>
<p>入力ファイルの準備・設定が完了後、実際に計算する方法について説明します。
サンプルスクリプトには、計算手順を簡略化するためのスクリプト  <code class="docutils literal notranslate"><span class="pre">AL.sh</span></code> が準備されています。
<code class="docutils literal notranslate"><span class="pre">run_pw.sh</span></code> はQEの計算を実行するためのスクリプトで、後述する <code class="docutils literal notranslate"><span class="pre">parallel_run.sh</span></code> 内部で呼び出されます。
<code class="docutils literal notranslate"><span class="pre">AL.sh</span></code> の中身は以下の通りです。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="c1">#SBATCH -p i8cpu</span>
<span class="c1">#SBATCH -N 4</span>
<span class="c1">#SBATCH -n 512</span>
<span class="c1">#SBATCH -J spinel</span>
<span class="c1">#SBATCH -c 1</span>
<span class="c1">#SBATCH --time=0:30:00</span>

<span class="c1"># Run reference DFT calc.</span>
<span class="nb">echo</span> start AL sample
srun -n <span class="m">8</span> abics_mlref input.toml &gt;&gt; abics_mlref.out

<span class="nb">echo</span> start parallel_run <span class="m">1</span>
sh parallel_run.sh

<span class="nb">echo</span> start AL final
srun -n <span class="m">8</span> abics_mlref input.toml &gt;&gt; abics_mlref.out

<span class="c1">#train</span>
<span class="nb">echo</span> start training
abics_train input.toml &gt;&gt; abics_train.out

<span class="nb">echo</span> Done
</pre></div>
</div>
<p>先頭の <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> で始まる数行は物性研スパコンでのジョブスケジューラに関するコマンドです。
ここでは、プロセス数512のMPI並列を指定しています。
また、 <code class="docutils literal notranslate"><span class="pre">srun</span></code> はスパコンの並列環境でプログラムを実行するためのコマンドです（ <code class="docutils literal notranslate"><span class="pre">mpiexec</span></code> に相当します）。
ジョブスケジューラに関する詳細は、実際に利用する計算機システムのマニュアルを参照してください。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run reference DFT calc.</span>
<span class="nb">echo</span> start AL sample
srun -n <span class="m">8</span> abics_mlref input.toml &gt;&gt; abics_mlref.out
</pre></div>
</div>
<p>まず、 <code class="docutils literal notranslate"><span class="pre">abics_mlref</span></code> を用いて訓練データの大元となる第一原理計算用の入力ファイルを生成します。
初回実行時は、指定した数の原子配置をランダムに生成し、
それぞれの原子配置ごとに個別のディレクトリを用意した上で、入力ファイルをその中に作成します。
あわせて、これらのディレクトリのpathを記載したファイル <code class="docutils literal notranslate"><span class="pre">rundirs.txt</span></code> を生成します。</p>
<p>次に、得られたファイルをもとに第一原理計算を実行します。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> start parallel_run <span class="m">1</span>
sh parallel_run.sh
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">parallel_run.sh</span></code> は、GNU parallelを用いてQEの網羅計算を行うためのスクリプトで、
<code class="docutils literal notranslate"><span class="pre">rundirs.txt</span></code> に記載されたディレクトリを対象にQEの網羅計算が行われます。
QEの計算結果はそれぞれのディレクトリに格納されます。</p>
<p>QEの網羅計算により教師データが作成されましたので、次にaenetでのニューラルネットワークポテンシャルの作成に移ります。
最初に、 <code class="docutils literal notranslate"><span class="pre">abics_mlref</span></code> を再度実行し、第一原理計算の結果をabics_trainが読み込む共通フォーマットに変換したファイルを作成します。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> start AL final
srun -n <span class="m">8</span> abics_mlref input.toml &gt;&gt; abics_mlref.out
</pre></div>
</div>
<p>次に、学習データをもとにaenetによりニューラルネットワークポテンシャルの作成を行います。
ニューラルネットワークポテンシャルの計算には <code class="docutils literal notranslate"><span class="pre">abics_train</span></code> を使います。
<code class="docutils literal notranslate"><span class="pre">[train]</span></code> セクションの <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> で指定したディレクトリに格納された入力ファイルを読み込み、計算を行います。
計算が無事終了すると、 <code class="docutils literal notranslate"><span class="pre">baseinput</span></code> ディレクトリに学習済みのニューラルネットワークが出力されます。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#train</span>
<span class="nb">echo</span> start training
abics_train input.toml &gt;&gt; abics_train.out
</pre></div>
</div>
<p>以上の手続きで、能動学習を行うための <code class="docutils literal notranslate"><span class="pre">AL.sh</span></code> のプロセスが完了します。</p>
</section>
</section>
</section>
<section id="id8">
<h1><span class="section-number">4.2. </span>モンテカルロサンプリング<a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h1>
<p>次に、学習したニューラルネットワークポテンシャルを用い、abICSによりモンテカルロサンプリングをします。</p>
<section id="id9">
<h2><span class="section-number">4.2.1. </span>入力ファイルの準備<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h2>
<p>abICS でモンテカルロサンプリングを行うにはabICS制御ファイルでパラメータの設定をする必要があります。</p>
<section id="id10">
<h3>abICS制御ファイル (<code class="docutils literal notranslate"><span class="pre">input.toml</span></code>)<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h3>
<p>レプリカ交換モンテカルロ法に関連するセクション <code class="docutils literal notranslate"><span class="pre">[sampling]</span></code> で計算パラメータを設定します。</p>
<section id="i-sampling">
<h4>(i)  <code class="docutils literal notranslate"><span class="pre">[sampling]</span></code> セクション<a class="headerlink" href="#i-sampling" title="Permalink to this heading">¶</a></h4>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[sampling]</span><span class="w"></span>
<span class="n">nreplicas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="n">nprocs_per_replica</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">kTstart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">600.0</span><span class="w"></span>
<span class="n">kTend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2000.0</span><span class="w"></span>
<span class="n">nsteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6400</span><span class="w"></span>
<span class="n">RXtrial_frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="n">sample_frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="w"></span>
<span class="n">print_frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">reload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
</pre></div>
</div>
<p>レプリカ交換モンテカルロ(RXMC)法のレプリカの数や温度範囲などに関する設定を行います（<a class="reference internal" href="../inputfiles/index.html"><span class="doc">入力ファイルフォーマット</span></a>）。
今回は、RXMC計算のエネルギーソルバーとしてaenetの <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> を用います。
現状、MPI版の <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> はサポートしていないため、 <code class="docutils literal notranslate"><span class="pre">nprocs_per_replica</span></code> は
1を指定してください。
基本的に、 <code class="docutils literal notranslate"><span class="pre">nreplicas</span></code> は <code class="docutils literal notranslate"><span class="pre">[mlref]</span></code> セクションと同じ値にしてください。</p>
</section>
<section id="ii-sampling-solver">
<h4>(ii)  <code class="docutils literal notranslate"><span class="pre">[sampling.solver]</span></code> セクション<a class="headerlink" href="#ii-sampling-solver" title="Permalink to this heading">¶</a></h4>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">sampling</span><span class="p">.</span><span class="n">solver</span><span class="p">]</span><span class="w"> </span><span class="c1"># RXMC計算に使うソルバーの設定</span><span class="w"></span>
<span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;aenet&#39;</span><span class="w"></span>
<span class="n">path</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;predict.x-2.0.4-ifort_serial&#39;</span><span class="w"></span>
<span class="n">base_input_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;./baseinput&#39;</span><span class="w"></span>
<span class="n">perturb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="n">run_scheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;subprocess&#39;</span><span class="w"></span>
<span class="n">ignore_species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;O&quot;</span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
<p>RXMC計算に使うエネルギーソルバーの設定を行います。今回は、aenetを使ってニューラルネットワークモデルの評価を行います。
<code class="docutils literal notranslate"><span class="pre">type</span></code> , <code class="docutils literal notranslate"><span class="pre">perturb</span></code> , <code class="docutils literal notranslate"><span class="pre">run_scheme</span></code> に関しては、能動学習スキームを用いる場合は上の例のまま変更しないでください。
<code class="docutils literal notranslate"><span class="pre">path</span></code> には、実行環境におけるaenetの <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> のパスを指定してください。 <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code>
は自由に設定して構いません。
設定したディレクトリの中に <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> に対応した入力ファイルが自動で設置されます（後述）。</p>
<p><code class="docutils literal notranslate"><span class="pre">ignore_species</span></code> では、
ニューラルネットワークモデルで「無視」する原子種を指定できます。今回の例題では、Oの副格子は常に占有率1なので、Oの
配置はエネルギーに影響を及ぼしません。こういった場合は、ニューラルネットワークモデルの訓練および評価時に存在を無視した方が、
計算効率が高くなります。</p>
</section>
</section>
</section>
<section id="id11">
<h2><span class="section-number">4.2.2. </span>計算実行<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h2>
<p>サンプルスクリプトには、計算手順を簡略化するためのスクリプト  <code class="docutils literal notranslate"><span class="pre">MC.sh</span></code> が準備されています。
<code class="docutils literal notranslate"><span class="pre">MC.sh</span></code> スクリプトの中身は以下の通りです。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="c1">#SBATCH -p i8cpu</span>
<span class="c1">#SBATCH -N 1</span>
<span class="c1">#SBATCH -n 8</span>
<span class="c1">#SBATCH --time=00:30:00</span>

srun -n <span class="m">8</span> abics_sampling input.toml &gt;&gt; aenet.out

<span class="nb">echo</span> Done
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">abics_sampling</span></code> を実行すると <code class="docutils literal notranslate"><span class="pre">MCxx</span></code> ディレクトリが作成されます (xxは実行回数)。
abICS では、active learning 向けに、ALloop.progress ファイルから計算回数などの情報を取得する機能が追加されています。
<code class="docutils literal notranslate"><span class="pre">MCxx</span></code> ディレクトリの下には、レプリカ数分だけのフォルダが作成され、
VASPのPOSCARファイル形式で記載された各ステップごとの原子配置(<code class="docutils literal notranslate"><span class="pre">structure.XXX.vasp</span></code>)、
最低エネルギーを与えた原子位置(<code class="docutils literal notranslate"><span class="pre">minE.vasp</span></code>)や、
各ステップごとの温度とエネルギー(<code class="docutils literal notranslate"><span class="pre">obs.dat</span></code>)などが出力されます。
詳細については <a class="reference external" href="https://issp-center-dev.github.io/abICS/docs/sphinx/ja/build/html/outputfiles/index.html">abICSマニュアルの出力ファイル</a> を参考にしてください。</p>
<p>上の手続きで得られた結果は、aenetにより求められたニューラルネットワークポテンシャルの精度に依存します。
はじめのステップではランダムな配置をもとに学習を行ったので、低温の構造については精度が低いことが予想されます。
そこで、モンテカルロで推定された構造に対して、再度第一原理計算でエネルギーを計算し再学習させます。
このステップを繰り返すことで、全温度領域での精度を高めることが期待されます。</p>
<p>このプロセスは、 <code class="docutils literal notranslate"><span class="pre">AL.sh</span></code> と <code class="docutils literal notranslate"><span class="pre">MC.sh</span></code> を順番に繰り返すことで計算できます。
実際に下図に反転率(DOI)を計算した結果を掲載します。
この例では、最初の一回目の結果がMC0、その後MC1, MC2, ..., MC5と5回実行させています。
最初の一回目が他のものとかなりずれていることから、精度が出ていないことが見てとれます。
一度モンテカルロを行った結果を元に学習させると、その次からはほぼ同じような値が得られていることがわかります。</p>
<a class="reference internal image-reference" href="../_images/doi_aenet.png"><img alt="../_images/doi_aenet.png" class="align-center" src="../_images/doi_aenet.png" style="width: 800px;" /></a>
<p>なお、DOIについては以下の手順で計算できます。</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>MCxx ディレクトリに移動する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">-n</span> <span class="pre">8</span> <span class="pre">abicsRXsepT</span> <span class="pre">../input.toml</span></code> を実行して <code class="docutils literal notranslate"><span class="pre">Tseparate</span></code> ディレクトリを作成する (並列数は <code class="docutils literal notranslate"><span class="pre">abics_sampling</span></code> を実行した際の並列数に揃える。本チュートリアルでは並列数を8にしているので8に設定)。</p></li>
<li><p>sampleディレクトリにある <code class="docutils literal notranslate"><span class="pre">calc_DOI.py</span></code> と <code class="docutils literal notranslate"><span class="pre">MgAl2O4.vasp</span></code> をコピーする。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">-n</span> <span class="pre">8</span> <span class="pre">python3</span> <span class="pre">calc_DOI.py</span> <span class="pre">../input.toml</span></code> を実行して温度ごとの反転度を計算する。 (並列数の指定は 2. と同様)。</p></li>
</ol>
</div></blockquote>
<p>一般的には、<code class="docutils literal notranslate"><span class="pre">MCxxx/Tseparate``の中に入っている温度ごとの構造ファイルから所望の熱力学平均を計算するスクリプト</span>
<span class="pre">（今回の場合は``calc_DOI.py</span></code>）をユーザーが用意する必要があります。</p>
<p>また、反転度の計算を完全に収束させるためには、例題のモンテカルロステップ数では不十分であることにご注意ください。
能動学習のサイクルとは別にモンテカルロステップ数を増やした計算を行って、熱力学平均を計算することをおすすめ
します。</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">abICS</a></h1>








<h3>ナビゲーション</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">1. abICS とは？</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">2. インストール方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_use/index.html">3. 基本的な使用方法</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. チュートリアル</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.1. ニューラルネットワークの構築</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">4.2. モンテカルロサンプリング</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../inputfiles/index.html">5. 入力ファイルフォーマット</a></li>
<li class="toctree-l1"><a class="reference internal" href="../outputfiles/index.html">6. 出力ファイルフォーマット</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">7. 付属ツール</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithm/index.html">8. アルゴリズム</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledge/index.html">9. 謝辞</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact/index.html">10. お問い合わせ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html"><span class="section-number">4. </span>チュートリアル</a><ul>
      <li>Previous: <a href="index.html" title="前の章へ"><span class="section-number">4. </span>チュートリアル</a></li>
      <li>Next: <a href="../inputfiles/index.html" title="次の章へ"><span class="section-number">5. </span>入力ファイルフォーマット</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-, Institute for Solid State Physics, University of Tokyo.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorial/aenet.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
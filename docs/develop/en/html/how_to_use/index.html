<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3. Basic Usage &#8212; abICS 2.3-dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=1e655c66" />
    <script src="../_static/documentation_options.js?v=4e4c84c2"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Tutorial" href="../tutorial/index.html" />
    <link rel="prev" title="2.1. Prerequisites" href="../install/install.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="basic-usage">
<span id="sec-basic-usage"></span><h1><span class="section-number">3. </span>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading">¶</a></h1>
<section id="active-learning">
<h2><span class="section-number">3.1. </span>Active learning<a class="headerlink" href="#active-learning" title="Link to this heading">¶</a></h2>
<p>abICS was originally developed for directly combining first-principles calculations with replica-exchange Monte Carlo methods to perform configurational sampling,
but the scale of the models and the number of steps that can be calculated are limited by the large computational cost of first-principles calculations.
In contrast, Ver. 2 implements an active learning method to construct a neural network model that can rapidly predict the energy after structural optimization,
dramatically improving the sampling speed <a class="reference external" href="https://doi.org/10.1063/5.0096645">[Kasamatsu et al., 2022]</a> .</p>
<p>The general flow of the active learning method implemented in abICS is as follows.</p>
<ol class="arabic simple">
<li><p>Perform ab initio calculations on a large number of randomly generated atomic configurations and prepare training data (correspondence between configurations and energies).</p></li>
<li><p>Build a neural network model that predicts energy from atomic configurations using the prepared training data.</p></li>
<li><p>Perform statistical thermodynamic sampling of atomic configurations using a replica exchange Monte Carlo method with a neural network model.</p></li>
<li><p>Evaluate the accuracy of the neural network model by sampling the ion configurations that appear in the Monte Carlo calculations and performing ab initio calculations on each of them.</p></li>
<li><p>If the accuracy is not sufficient, add the results calculated in 4. to the training data and repeat from 2.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/al_scheme.png"><img alt="../_images/al_scheme.png" class="align-center" src="../_images/al_scheme.png" style="width: 800px;" />
</a>
<p>Schematic of the active learning procedure using abICS</p>
</section>
<section id="preparing-an-abics-control-file">
<span id="subsec-basic-reference"></span><h2><span class="section-number">3.2. </span>Preparing an abICS control file<a class="headerlink" href="#preparing-an-abics-control-file" title="Link to this heading">¶</a></h2>
<p>First, we have to prepare an input file that controls the entire abICS framework.
The input file of abICS is comprised of the following five sections:</p>
<ol class="arabic simple">
<li><p>[sampling] section specifies the parameters of the replica exchange Monte Carlo part, such as the number of replicas, the temperature range, and the number of Monte Carlo steps. In addition, [sampling.solver] subsection specifies the parameters for the (first principle calculation) solver, including the type of solver (VASP, QE,…), the path to the solver, and the directory containing immutable input files.</p></li>
<li><p>[mlref] section specifies options for extracting only atomic configurations from the sampling results in order to evaluate the accuracy of the neural network model and to expand the training data. In addition, for generating training data, [mlref.solver] subsection specifies the parameters for the (first principle calculation) solver, including the type of solver (VASP, QE,…), the path to the solver, and the directory containing immutable input files. This section is used for <code class="docutils literal notranslate"><span class="pre">abics_mlref</span></code> .</p></li>
<li><p>[train] section specifies optinons for making a trainer to learn a placement energy prediction model from training data.  This section is used for <code class="docutils literal notranslate"><span class="pre">abics_train</span></code> .</p></li>
<li><p>[observer] section specifies the type of physical quantity to be calculated.</p></li>
<li><p>[config] section specifies the configuration of the alloy, etc.</p></li>
</ol>
<p>For details, see <a class="reference internal" href="../inputfiles/index.html"><span class="doc">Input Files Format</span></a> .
The following is an example of an input file selecting aenet as a solver.</p>
</section>
<section id="preparing-a-reference-file-for-first-principles-solvers">
<h2><span class="section-number">3.3. </span>Preparing a reference file for first-principles solvers<a class="headerlink" href="#preparing-a-reference-file-for-first-principles-solvers" title="Link to this heading">¶</a></h2>
<p>The user must prepare reference input file(s) for first-principles solvers that are used for
generating the training data according to the input format of the solver.
The path of the reference file is specified by <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> in the <code class="docutils literal notranslate"><span class="pre">[mlref.solver]</span></code> section in the abICS input file (see below).
The coordinate information should not be written here; it will be written by abICS.
The following is an example of a QE reference file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&amp;CONTROL
  calculation = &#39;relax&#39;
  tstress = .false.
  tprnfor = .false.
  pseudo_dir = &#39;./pseudo&#39;
  disk_io = &#39;low&#39;
  wf_collect = .false.
/
&amp;SYSTEM
  ecutwfc      =  60.0
  occupations  = &quot;smearing&quot;
  smearing     = &quot;gauss&quot;
  degauss      = 0.01
/
&amp;electrons
  mixing_beta = 0.7
  conv_thr = 1.0d-8
  electron_maxstep = 100
/
&amp;ions
/
ATOMIC_SPECIES
Al 26.981 Al.pbe-nl-kjpaw_psl.1.0.0.UPF
Mg 24.305 Mg.pbe-spnl-kjpaw_psl.1.0.0.UPF
O  16.000 O.pbe-n-kjpaw_psl.1.0.0.UPF
ATOMIC_POSITIONS crystal

K_POINTS gamma
</pre></div>
</div>
<section id="specific-notes-for-first-principles-solvers">
<span id="solver-specific-notes"></span><h3><span class="section-number">3.3.1. </span>Specific notes for first-principles solvers<a class="headerlink" href="#specific-notes-for-first-principles-solvers" title="Link to this heading">¶</a></h3>
<p>Every setting other than those pertaining to the atomic coordinates should be set in the solver
reference input file.
However, the specification of atoms to be relaxed can be controlled by abICS.
To enable the structural optimization option, please set the option to do structural optimization in the reference file of the solver, and also specify the related parameters such as the total number of steps for relaxation.
Furthermore, to interoperate with abICS, there are a few rules regarding the file name and contents
of the reference file for each solver. We’ll explain them below.</p>
<section id="vasp">
<h4>VASP<a class="headerlink" href="#vasp" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>URL : <a class="reference external" href="https://www.vasp.at">https://www.vasp.at</a></p></li>
<li><p>Reference file rules</p>
<ul>
<li><p>Please prepare INCAR, POTCAR, KPOINTS files.</p>
<ul>
<li><p>In POTCAR file, please arrange the atoms in alphabetical order.</p></li>
<li><p>The POSCAR file is basically not needed, but maybe needed depending on the version of <code class="docutils literal notranslate"><span class="pre">pymatgen</span></code>.
In that case, please prepare a suitable file.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="quantum-espresso">
<h4>Quantum Espresso<a class="headerlink" href="#quantum-espresso" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>URL : <a class="reference external" href="https://www.quantum-espresso.org">https://www.quantum-espresso.org</a></p></li>
<li><p>Available version: 6.2 or higher</p>
<ul>
<li><p>“Old XML” format is not available</p></li>
</ul>
</li>
<li><p>Reference file rules</p>
<ul>
<li><p>Please set the reference file name as <code class="docutils literal notranslate"><span class="pre">scf.in</span></code> .</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calculation</span></code> option must be <code class="docutils literal notranslate"><span class="pre">scf</span></code> or <code class="docutils literal notranslate"><span class="pre">relax</span></code> .</p></li>
<li><p>If the calculation is done only at <span class="math notranslate nohighlight">\(\Gamma\)</span> point, the calculation becomes fast if you set <code class="docutils literal notranslate"><span class="pre">Gamma</span></code> in <code class="docutils literal notranslate"><span class="pre">kpoints</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="openmx">
<h4>OpenMX<a class="headerlink" href="#openmx" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>URL : <a class="reference external" href="http://www.openmx-square.org">http://www.openmx-square.org</a></p></li>
<li><p>Available version: 3.9</p></li>
<li><p>Reference file rule</p>
<ul>
<li><p>Please set the reference file name as <code class="docutils literal notranslate"><span class="pre">base.dat</span></code> .</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="preparing-a-reference-file-for-training-and-evaluating-the-machine-learning-model">
<h2><span class="section-number">3.4. </span>Preparing a reference file for training and evaluating the machine learning model<a class="headerlink" href="#preparing-a-reference-file-for-training-and-evaluating-the-machine-learning-model" title="Link to this heading">¶</a></h2>
<p>The user must prepare a reference file according to the input format of the
machine learning model trainer and calculator to be used (only aenet is supported at the moment).
The path of the reference file is specified by <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> in the <code class="docutils literal notranslate"><span class="pre">[solver]</span></code> section in the abICS input file (see below).
The coordinate information should not be written here because it will obviously change in the course of the simulation.
The lattice sites are specified in a separate abICS input file (see below),
and abICS will take care of generating the coordinates section at each sampling step.</p>
<section id="machine-learning-trainer-calculator-specific-notes">
<span id="trainer-specific-notes"></span><h3><span class="section-number">3.4.1. </span>Machine learning trainer/calculator-specific notes<a class="headerlink" href="#machine-learning-trainer-calculator-specific-notes" title="Link to this heading">¶</a></h3>
<ul>
<li><p>abICS control file</p>
<ul class="simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">[solver]</span></code> section, set <code class="docutils literal notranslate"><span class="pre">perturb</span></code> be 0.0.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;aenet&quot;</span>
<span class="nv">perturb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</pre></div>
</div>
</li>
</ul>
<section id="aenet">
<h4>aenet<a class="headerlink" href="#aenet" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>URL : <a class="reference external" href="http://ann.atomistic.net">http://ann.atomistic.net</a></p></li>
<li><p>Checked with aenet 2.0.4.</p></li>
<li><p>Reference file rules</p>
<ul>
<li><p>Place the input files for aenet in the <code class="docutils literal notranslate"><span class="pre">generate</span></code>, <code class="docutils literal notranslate"><span class="pre">train</span></code>, and <code class="docutils literal notranslate"><span class="pre">predict</span></code> directories in the directory which is set in the <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> of the <code class="docutils literal notranslate"><span class="pre">[trainer]</span></code> section.</p></li>
<li><p>aenet compiles the atomic configuration and energy data for training into an intermediate binary format that is converted to atomic environment descriptor-energy relationships before training. Please place the input files for this conversion <code class="docutils literal notranslate"><span class="pre">generate.x</span></code> in the <code class="docutils literal notranslate"><span class="pre">generate</span></code> directory.</p></li>
<li><p>Place an input file for <code class="docutils literal notranslate"><span class="pre">train.x</span></code> in the <code class="docutils literal notranslate"><span class="pre">train</span></code> directory that reads the training data generated by <code class="docutils literal notranslate"><span class="pre">generate.x</span></code> and trains. The file should be named <code class="docutils literal notranslate"><span class="pre">train.in</span></code>.</p></li>
<li><p>Place the input file <code class="docutils literal notranslate"><span class="pre">predict.in</span></code> for <code class="docutils literal notranslate"><span class="pre">predict.x</span></code> in the <code class="docutils literal notranslate"><span class="pre">predict</span></code> directory to evaluate the energy for the input coordinates using the trained potential model.</p></li>
</ul>
</li>
</ul>
</section>
<section id="nequip">
<h4>NequIP<a class="headerlink" href="#nequip" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>URL : <a class="reference external" href="https://github.com/mir-group/nequip">https://github.com/mir-group/nequip</a></p></li>
<li><p>Checked with nequip 0.6.1.</p></li>
<li><p>Reference file(For specific examples of reference files, see the tutorial)</p>
<ul>
<li><p>Place the input file for NequIP <code class="docutils literal notranslate"><span class="pre">input.yaml</span></code> in the <code class="docutils literal notranslate"><span class="pre">train</span></code> directory in the directory set in the <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> of the <code class="docutils literal notranslate"><span class="pre">[trainer]</span></code> section.</p></li>
<li><p>Set the RATIO of training data and validation data in <code class="docutils literal notranslate"><span class="pre">n_train</span></code> and <code class="docutils literal notranslate"><span class="pre">n_val</span></code>. For example, if you set <code class="docutils literal notranslate"><span class="pre">n_train</span> <span class="pre">=</span> <span class="pre">80%</span></code> and <code class="docutils literal notranslate"><span class="pre">n_val</span> <span class="pre">=</span> <span class="pre">20%</span></code>, the ratio of training data and validation data will be 80% and 20%, respectively.</p></li>
</ul>
</li>
</ul>
</section>
<section id="mlip-3">
<h4>MLIP-3<a class="headerlink" href="#mlip-3" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>URL : <a class="reference external" href="https://gitlab.com/ashapeev/mlip-3">https://gitlab.com/ashapeev/mlip-3</a></p></li>
<li><p>Checked with commit hash 5f6970e3966c5941a4b42b27a3e9170f162532a0 (2023-06-06T21:27:11).</p></li>
<li><p>Reference file(For specific examples of reference files, see the tutorial)</p>
<ul>
<li><p>Place the input file for MLIP-3 <code class="docutils literal notranslate"><span class="pre">input.almtp</span></code> in the <code class="docutils literal notranslate"><span class="pre">train</span></code> directory in the directory set in the <code class="docutils literal notranslate"><span class="pre">base_input_dir</span></code> of the <code class="docutils literal notranslate"><span class="pre">[trainer]</span></code> section.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="creating-a-set-of-training-data">
<h2><span class="section-number">3.5. </span>Creating a set of training data<a class="headerlink" href="#creating-a-set-of-training-data" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Generate a set of input files for the first-principle calculation using <code class="docutils literal notranslate"><span class="pre">abics_mlref</span></code>.</p></li>
<li><p>Perform the first-principle calculation with these inputs. (In the tutorial GNU parallel is used for the high-throughput calculation.)</p></li>
</ol>
</section>
<section id="creating-a-neural-network">
<h2><span class="section-number">3.6. </span>Creating a neural network<a class="headerlink" href="#creating-a-neural-network" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">abics_mlref</span></code> again to convert the results of the first-principle calculation into a common format that <code class="docutils literal notranslate"><span class="pre">abics_train</span></code> will read.</p></li>
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">abics_train</span></code> to create a neural network. When the calculation is completed successfully, the trained neural network is output in <code class="docutils literal notranslate"><span class="pre">baseinput</span></code> directory.</p></li>
</ol>
</section>
<section id="monte-carlo-sampling">
<h2><span class="section-number">3.7. </span>Monte Carlo sampling<a class="headerlink" href="#monte-carlo-sampling" title="Link to this heading">¶</a></h2>
<p>By using <code class="docutils literal notranslate"><span class="pre">abics_sampling</span></code>, Monte Carlo sampling can be performed by using the trained neural network.
(The number of MPI processes must be larger than the number of replicas.)
Running the program will create directories named by the replica numbers under the current directory,
and each replica runs the solver in it.</p>
<p>abICS can call the <code class="docutils literal notranslate"><span class="pre">aenet</span></code> library via the LAMMPS interface (<code class="docutils literal notranslate"><span class="pre">aenetPyLammps</span></code>).
This is faster than calling <code class="docutils literal notranslate"><span class="pre">aenet</span></code> directly because it does not need file I/O.
To use <code class="docutils literal notranslate"><span class="pre">aenetPyLammps</span></code>, you need to install <code class="docutils literal notranslate"><span class="pre">aenet-lammps</span></code> and <code class="docutils literal notranslate"><span class="pre">lammps</span></code>.
For details, please refer to the <a class="reference internal" href="../tutorial/aenet.html#tutorial-aenet-lammps"><span class="std std-ref">Predict energy of annet model via LAMMPS interface</span></a>.</p>
</section>
<section id="post-processing">
<h2><span class="section-number">3.8. </span>Post-processing<a class="headerlink" href="#post-processing" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">abics_sampling</span></code> outputs the expectation values of physical quantities for each temperature.
To calculate other physical quantities using the configurations sampled by <code class="docutils literal notranslate"><span class="pre">abics_sampling</span></code> (without resampling), use <code class="docutils literal notranslate"><span class="pre">abics_postproc</span></code>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">abICS</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">1. About abICS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">2. Install</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#active-learning">3.1. Active learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-an-abics-control-file">3.2. Preparing an abICS control file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-a-reference-file-for-first-principles-solvers">3.3. Preparing a reference file for first-principles solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-a-reference-file-for-training-and-evaluating-the-machine-learning-model">3.4. Preparing a reference file for training and evaluating the machine learning model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-set-of-training-data">3.5. Creating a set of training data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-neural-network">3.6. Creating a neural network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#monte-carlo-sampling">3.7. Monte Carlo sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-processing">3.8. Post-processing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">4. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inputfiles/index.html">5. Input Files Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../outputfiles/index.html">6. Output Files Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">7. Miscellaneous tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithm/index.html">8. Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledge/index.html">9. Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact/index.html">10. Contacts</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../install/install.html" title="previous chapter"><span class="section-number">2.1. </span>Prerequisites</a></li>
      <li>Next: <a href="../tutorial/index.html" title="next chapter"><span class="section-number">4. </span>Tutorial</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019-, Institute for Solid State Physics, University of Tokyo.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/how_to_use/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>